# multizone-api
# Copyright(C) 2018 Hex Five Security, Inc. - All Rights Reserved
MultiZone Security API

The design point of the MultiZone nanoKernel is to be minimalist - additional services can be built into Zones as needed.

The API definition is:

Function	           Syntax and function	                                Example
ECALL_YIELD	         ECALL_YIELD()                                        ECALL_YIELD();
                     Indicates to the nanoKernel scheduler                 
                     that the Zone has nothing pressing to
                     do and causes the nanoKernel to immediately
                     move to the next Zone in context.	

                     In the case of a three zone implementation with
                     a tick time of 10ms, the maximum time to come
                     back to context is 20ms, faster if the other 
                     zones Yield as well.

ECALL_SEND	         ECALL_SEND([Zone #], [0-3][Int])                     ECALL_SEND(1, {201, 0, 0 ,0});
                     Send transmits a message from the current zone       Sends an array to Zone 1 of {201, 0, 0, 0}
                     to the [Zone #]; the message size is an array
                     of [4] integers and the nanoKernel manages
                     transmission with no shared memory.	

ECALL_RECV	         ECALL_RECV[Zone #], [0-3][int]);                     int msg[4]={0,0,0,0};
                     Checks the mailbox of the current Zone for a         ECALL_RECV(1, msg);
                     message from the listed Zone #, if a message
                     exists it copies it to the array structure
                     provided.	

                     If a message exists in the mailbox from zone 1,
                     it copies it to msg, otherwise msg value is 
                     unchanged.

ECALL_TRP_VECT	     ECALL_TRP_VECT([Exception Code], [Trap Handler])     ECALL_TRP_VECT(0x0, trap_0x0_handler);
                     Registers a handler against a trap generated by      Where trap_0x0_handler is registered at the
                     unauthorized instructions; the TRAP #s are defined   User level of privilege with:
                     in the RISC-V Privileged Architectures definition    Void trap_0x0_handler(void)__attribute__((interrupt("user")));
                     V1.1, Table 3.6 Interrupt 0 types.                   void trap_0x0_handler(void){
                     https://riscv.org/specifications/privileged-isa/       // Your handler code here
                                                                          }

ECALL_IRQ_VECT	     ECALL_IRQ_VECT([Interrupt #], [Trap Handler])        ECALL_IRQ_VECT(11, button_0_handler);
                     Registers a handler for an interrupt that has        Where button_0_handler is registered at
                     been assigned to a Zone in the multizone.cfg file.   the user level of privilege with:
                                                                          void button_1_handler(void)__attribute__((interrupt("user")));
                     When an interrupt occurs, the nanoKernel will        void button_1_handler(void){
                     immediately pull the zone assigned to that             // interrupt handler here
                     interrupt into context and execute the registered    }
                     interrupt handler.	

ECALL_CSRR_MTIME()	 Returns MTIME to a variable in a zone, MTIME         Int64 mtime = ECALL_CSRR_MTIME();
                     is a privileged registered normally only 
                     available in M mode.	

ECALL_CSRR_MCYCLE()  Returns MCYCLE to a variable in a zone, MCYCLE       Int64 mcycle = ECALL_CSRR_MCYCLE();
                     is a privileged registered normally only
                     available in M mode.	

ECALL_CSRR_MINSTR()	 Returns MINSTR to a variable in a zone, MINSTR       Int64 minstr = ECALL_CSRR_MINSTR(); 
                     is a privileged registered normally only
                     available in M mode.	

ECALL_CSRR_MHPMC3()	 Returns MHPMC3 to a variable in a zone, MHPMC3       Int64 mhpmc3 = ECALL_CSRR_MHPMC3();
                     is a privileged registered normally only available
                     in M mode.	

ECALL_CSRR_MHPMC4()  Returns MHPMC4 to a variable in a zone, MHPMC4       Int64 mhpmc3 = ECALL_CSRR_MHPMC4();
                     is a privileged registered normally only available
                     in M mode.	

ECALL_CSRR_MISA()    Returns MISA to a variable in a zone, MISA is a      Int64 misa = ECALL_CSRR_MISA();
                     privileged registered normally only available in
                     M mode.	

ECALL_CSRR_MVENDID() Returns MVENDID to a variable in a zone, MVENDID     Int64 misa = ECALL_CSRR_MVENDID();
                     is a privileged registered normally only available
                     in M mode.	

ECALL_CSRR_MARCHID() Returns MARCHID to a variable in a zone, MARCHID     Int64 marchid = ECALL_CSRR_MARCHID();
                     is a privileged registered normally only available
                     in M mode.	

ECALL_CSRR_MIMPID()	 Returns MIMPID to a variable in a zone,  MIMPID is   Int64 mimpid = ECALL_CSRR_ MIMPID();
                     a privileged registered normally only available
                     in M mode.	

ECALL_CSRR_MHARTID() Returns MHARTID to a variable in a zone,  MHARTID    Int64 mhardid = ECALL_CSRR_ MHARTID();
                     is a privileged registered normally only available
                     in M mode.	
